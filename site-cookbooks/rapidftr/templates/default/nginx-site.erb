server {
  listen <%= @http_port %>;
  server_name <%= @host %>;
  rewrite ^(.*)$ https://$host:<%= @https_port %>$1 redirect;
}

server {
  listen <%= @https_port %> ssl spdy;
  server_name <%= @host %>;

  ssl on;
  ssl_certificate <%= @cert_dir %>/certificate.crt;
  ssl_certificate_key <%= @cert_dir %>/certificate.key;

  passenger_enabled on;
  passenger_min_instances 1;

  # required by execjs to properly locate nodejs
  passenger_set_cgi_param PATH '/usr/bin';

  rails_env <%= @rails_env %>;
  gzip on;
  gzip_disable "MSIE [1-6]\.";
  etag off;

  root <%= @release_dir %>/public;
  access_log <%= @release_dir %>/log/server.log;
  error_log <%= @release_dir %>/log/error.log error;
  client_max_body_size 50M;

  location ~ ^/assets/ {
    gzip_static on;
    expires max;
    add_header Cache-Control public;
    break;
  }
}

passenger_pre_start https://<%= @host %>:<%= @https_port %>/;
